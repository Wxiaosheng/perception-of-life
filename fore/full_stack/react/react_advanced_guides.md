1. [é«˜çº§æŒ‡å¼•](/fore/full_stack/react/react_advanced_guides?id=é«˜çº§æŒ‡å¼•)
2. [Context](/fore/full_stack/react/react_context)




## é«˜çº§æŒ‡å¼•
#### ä»£ç åˆ†å‰²
&emsp;&emsp;æ‰“åŒ…æ˜¯ä»ä¸€ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œæ‰¾åˆ°å…¶æ‰€æœ‰æœ‰å…³çš„æ–‡ä»¶ï¼Œå¹¶æœ€ç»ˆåˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚   
&emsp;&emsp;å°†æ‰“åŒ…çš„ç»“æœåˆ†æˆå¤šä¸ªåŒ…æ–‡ä»¶å¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚  
&emsp;&emsp;å¯¹åº”ç”¨è¿›è¡Œä»£ç åˆ†å‰²èƒ½å¤Ÿå¸®åŠ©ä½ "**æ‡’åŠ è½½**"å½“å‰ç”¨æˆ·æ‰€éœ€è¦çš„å†…å®¹ï¼Œèƒ½å¤Ÿæ˜¾è‘—æé«˜åº”ç”¨çš„æ€§èƒ½ã€‚å°½ç®¡å¹¶æ²¡æœ‰å‡å°‘åº”ç”¨çš„æ•´ä½“çš„ä»£ç ä½“ç§¯ï¼Œä½†æ˜¯**èƒ½å¤Ÿé¿å…åŠ è½½ç”¨æˆ·æ°¸è¿œä¹Ÿç”¨ä¸åˆ°çš„ä»£ç ï¼Œå¹¶åœ¨åˆå§‹åŠ è½½çš„æ—¶å€™å‡å°‘æ‰€éœ€çš„ä»£ç é‡**ã€‚  

#### import()
&emsp;&emsp;åœ¨åº”ç”¨ä¸­å¼•å…¥ä»£ç åˆ†å‰²çš„æœ€ä½³æ–¹å¼æ˜¯é€šè¿‡åŠ¨æ€ import() è¯­æ³•ã€‚  
&emsp;&emsp;æ³¨æ„ï¼š  
&emsp;&emsp;&emsp;&emsp;1ã€åŠ¨æ€ import() è¯­æ³•ç›®å‰åªæ˜¯ä¸€ä¸ª ECMAScript ææ¡ˆï¼Œè€Œä¸æ˜¯æ­£å¼çš„æ ‡å‡†è¯­æ³•ã€‚  
&emsp;&emsp;&emsp;&emsp;2ã€å¦‚æœä½¿ç”¨ Create React App è¯¥åŠŸèƒ½å·²ç»é…ç½®å¥½ï¼Œå¦‚æœæ˜¯è‡ªå·±æ­å»ºçš„ Webpackï¼Œåˆ™éœ€è¦è¿›è¡Œä»£ç åˆ†å‰²çš„é…ç½®ã€‚  
&emsp;&emsp;&emsp;&emsp;3ã€å½“ä½¿ç”¨babelæ—¶ï¼Œè¦ä½¿ç”¨ babel-plugin-syntax-dynamic-import æ’ä»¶ è§£æåŠ¨æ€ import è¯­æ³•ï¼Œè€Œä¸æ˜¯å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚  

#### React.lazy
&emsp;&emsp;&emsp;&emsp;React.lazy å‡½æ•°èƒ½è®©ä½ åƒæ¸²æŸ“å¸¸è§„ç»„ä»¶ä¸€æ ·å¤„ç†åŠ¨æ€å¼•å…¥(çš„ç»„ä»¶)  
&emsp;&emsp;&emsp;&emsp;React.lazy æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦åŠ¨æ€çš„è°ƒç”¨ import()ï¼Œå®ƒå¿…é¡»è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise éœ€è¦ resolve ä¸€ä¸ª default export çš„ React ç»„ä»¶ã€‚  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;**const OtherComponent = React.lazy(() => import('./OtherComponent'))**  
&emsp;&emsp;æ­¤ä»£ç å°†**åœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œè‡ªåŠ¨å¯¼å…¥åŒ…å« OtherComponent ç»„ä»¶çš„åŒ…**ã€‚  
&emsp;&emsp;åº”åœ¨ Suspense ç»„ä»¶ä¸­æ¸²æŸ“ lazy ç»„ä»¶ï¼Œfallback å±æ€§æ¥å—ä»»ä½•åœ¨ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­ä½ æƒ³å±•ç°çš„ React ç»„ä»¶ï¼Œå¦‚æ­¤ä½¿å¾—åœ¨ç­‰å¾…åŠ è½½ lazy ç»„ä»¶æ—¶åšä¼˜é›…é™çº§ã€‚  
&emsp;&emsp;Suspense ç»„ä»¶ç½®äºæ‡’åŠ è½½ç»„ä»¶ä¹‹ä¸Šçš„ä»»ä½•ä½ç½®ï¼Œä½ ç”šè‡³å¯ä»¥ç”¨ä¸€ä¸ª Suspense ç»„ä»¶åŒ…è£¹å¤šä¸ªæ‡’åŠ è½½ç»„ä»¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¸€èˆ¬æ”¾ç½®åœ¨æœ€å¤–å±‚å³å¯ã€‚

##### å¼‚å¸¸æ•è·è¾¹ç•Œ
&emsp;&emsp;å¦‚æœæ¨¡å—åŠ è½½å¤±è´¥(ç½‘ç»œé—®é¢˜)ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯ã€‚å¯ä»¥é€šè¿‡ **å¼‚å¸¸æ•è·è¾¹ç•Œ(Errorboundaries)** æŠ€æœ¯æ¥å¤„ç†è¿™äº›æƒ…å†µï¼Œç»™ç”¨æˆ·ä»¥è‰¯å¥½çš„ä½“éªŒã€‚  
##### åŸºäºè·¯ç”±çš„ä»£ç åˆ†å‰²
&emsp;&emsp;å†³å®šåœ¨å“ªé‡Œå¼•å…¥ä»£ç åˆ†å‰²éœ€è¦ä¸€äº›æŠ€å·§ï¼Œå› ä¸ºéœ€è¦ç¡®ä¿é€‰æ‹©çš„ä½ç½®èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å‰²ä»£ç åŒ…è€Œä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚ä¸€ä¸ªä¸é”™çš„é€‰æ‹©å°±æ˜¯ä»è·¯ç”±å¼€å§‹ï¼Œå¤§å¤šæ•°ç½‘ç»œç”¨æˆ·ä¹ æƒ¯äºé¡µé¢ä¹‹é—´èƒ½æœ‰ä¸ªåŠ è½½åˆ‡æ¢çš„è¿‡ç¨‹ã€‚   


### é”™è¯¯è¾¹ç•Œ
&emsp;&emsp;éƒ¨åˆ† UI(ç»„ä»¶) çš„ JavaScript é”™è¯¯ä¸åº”è¯¥å¯¼è‡´æ•´ä¸ªåº”ç”¨çš„å´©æºƒï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact 16 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œ-- é”™è¯¯è¾¹ç•Œ(Error Boundary)ã€‚  
&emsp;&emsp;è¾¹ç•Œé”™è¯¯æ˜¯ä¸€ç§ React ç»„ä»¶ï¼Œè¿™ç§ç»„ä»¶**å¯ä»¥æ•è·å¹¶æ‰“å°å‘ç”Ÿåœ¨å…¶å­ç»„ä»¶æ ‘ä»»ä½•ä½ç½®çš„ JavaScript é”™è¯¯**ï¼Œå¹¶ä¸”å®ƒä¼šæ¸²æŸ“å‡ºå¤‡ç”¨ UIï¼Œè€Œä¸ä¼šæ¸²æŸ“é‚£äº›å´©æºƒäº†çš„å­ç»„ä»¶æ ‘ã€‚

&emsp;&emsp;æ³¨æ„ï¼š(é”™è¯¯è¾¹ç•Œ **æ— æ³•æ•è·** ä»¥ä¸‹åœºæ™¯ä¸­äº§ç”Ÿçš„é”™è¯¯)  
&emsp;&emsp;&emsp;&emsp;1ã€äº‹ä»¶å¤„ç†([äº†è§£æ›´å¤š][1])  
&emsp;&emsp;&emsp;&emsp;2ã€å¼‚æ­¥ä»£ç (ä¾‹å¦‚ setTimeout æˆ– requestAnimationFrame å›è°ƒå‡½æ•°)  
&emsp;&emsp;&emsp;&emsp;3ã€æœåŠ¡ç«¯æ¸²æŸ“  
&emsp;&emsp;&emsp;&emsp;4ã€è‡ªèº«æŠ›å‡ºçš„é”™è¯¯(å¹¶éå®ƒçš„å­ç»„ä»¶)  

&emsp;&emsp;æ˜¯ç”¨ä¸€ä¸ª class ç»„ä»¶å®šä¹‰äº† static getDerivedStateFromError() æˆ– componentDidCatch() è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­çš„ä»»æ„ä¸€ä¸ª(æˆ–ä¸¤ä¸ª)æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±å˜æˆäº†ä¸€ä¸ªé”™è¯¯è¾¹ç•Œã€‚  
&emsp;&emsp;é€šå¸¸æƒ…å†µä¸‹ï¼Œ**åœ¨å‘ç”Ÿé”™è¯¯åï¼Œä½¿ç”¨ static getDerivedStateFromError() æ¸²æŸ“å¤‡ç”¨UIï¼Œä½¿ç”¨ componentDidCatch() æ‰“å°æˆ–ä¸ŠæŠ¥é”™è¯¯ä¿¡æ¯**ã€‚   
&emsp;&emsp;ğŸ‘‡ä½¿ç”¨æ–¹æ³•è¯·å‚ç…§ä¸‹é¢çš„ä»£ç ï¼š 
```javascript
// é”™è¯¯è¾¹ç•Œç»„ä»¶
import React, { Component } from 'react'

export default class ErrorBoundary extends Component {
  constructor(props){
    super(props)

    this.state = {
      hasError: false,
      errorInfo: {}
    }
  }
  static getDerivedStateFromError(error){
    // å¤„ç†éœ€è¦å±•ç¤ºç»™ç”¨æˆ·çš„å‹å¥½é”™è¯¯æç¤ºä¿¡æ¯
    console.log('getDerivedStateFromError')
    console.log(error)
    return { hasError: true, errorInfo: error }
  }

  componentDidCatch(error, errorInfo){
    // åšé”™è¯¯äº‹ä»¶çš„ä¸ŠæŠ¥
    console.log('componentDidCatch')
    console.log(error, errorInfo)
  }

  render(){
    return <div style={{ fontSize: '0.16rem' }}>
      {this.state.hasError ? `è¯·è”ç³»ç½‘ç«™ç»´æŠ¤äººå‘˜å¤„ç†ï¼ ${this.state.errorInfo.toString()}` : this.props.children}
    </div>
  }
}

// é€šå¸¸æ”¾åœ¨åœ¨è·¯ç”±å±‚çº§åšç»Ÿä¸€å¤„ç†ï¼Œè¿™æ ·åœ¨è·¯ç”±ä¸‹é¢çš„æ‰€æœ‰å­ç»„ä»¶åœ¨æ¸²æŸ“æ—¶çš„é”™è¯¯éƒ½ä¼šè¢«é”™è¯¯è¾¹ç•Œæ•è·ï¼Œè€Œå¤„ç†æˆå‹å¥½çš„å“åº”å½¢å¼
import React, { Component } from 'react'
import { Switch, Route } from 'react-router-dom'
import ErrorBoundary from '../pages/ErrorBoundary'
import Home from '../pages/Home'
import List from '../pages/List'

export default class Router extends Component {
  render() {
    return (
      <ErrorBoundary>
        <Switch>
          <Route path="/" exact component={Home} />
          <Route path="/list" exact component={List} />
        </Switch>
      </ErrorBoundary>
    )
  }
}
```

#### react å¸¸è§çš„é”™è¯¯æœ‰
> è‡ªå·±æ€»ç»“å½’çº³çš„  

&emsp;&emsp;1ã€**æ¸²æŸ“æ—¶çš„é”™è¯¯**ï¼Œæ¯”å¦‚é€šè¿‡æ•°æ®æ¸²æŸ“ UI æ—¶ï¼Œå¦‚æ•°æ®ç»“æ„ç¼ºå¤±(array.length çš„ array ä¸º undefined)æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ä»£ç æŠ¥é”™ï¼Œé»˜è®¤ä¸å¤„ç†æƒ…å†µä¸‹ï¼Œ**é¡µé¢ä¼šç›´æ¥ç™½å±**ï¼Œä½“éªŒéå¸¸ä¸å‹å¥½(æ³¨æ„ï¼Œ**å¦‚æœä½ æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒï¼Œé‚£ä¹ˆé¡µé¢ä¼šå‡ºç°é”™è¯¯ï¼Œä½†æ˜¯å¦‚æœæ‰“åŒ…å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸Šå°±æ˜¯ç›´æ¥ç™½å±ï¼ŒåŒä¸€æ ·çš„é”™è¯¯ï¼Œæµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„è¡¨ç°ä¼šä¸åŒ**)  

&emsp;&emsp;2ã€**å¼‚æ­¥setTimeout å’Œ äº‹ä»¶å¤„ç† å‘ç”Ÿçš„é”™è¯¯**ï¼Œè¿™ç§é”™è¯¯åªæ˜¯ javascript ä»£ç æŠ¥é”™ï¼Œåªä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œæœ€å¤šå¯¼è‡´ç‚¹å‡»æ— å“åº”ï¼Œå¹¶ä¸ä¼šè§¦å‘ React é‡æ–°æ¸²æŸ“DOMï¼Œå› è€Œ React ä»ç„¶èƒ½å¤ŸçŸ¥é“éœ€è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä»€ä¹ˆã€‚  

&emsp;&emsp;3ã€äº‹ä»¶å¤„ç† å¯¼è‡´çš„æ•°æ®å˜åŒ–ï¼Œè§¦å‘äº† React é‡æ–°æ¸²æŸ“DOMï¼Œè¦æ³¨æ„**è¿™ä¸ªæ—¶å€™çš„é”™è¯¯å…¶å®æ˜¯æ¸²æŸ“æ—¶çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯ äº‹ä»¶å¤„ç†çš„é”™è¯¯**ï¼Œå› æ­¤å‚ç…§ 1 å³å¯ã€‚

&emsp;&emsp;ç»¼ä¸Šï¼Œåœ¨è‡ªå·±é¡¹ç›®ä¸­å¦‚ä½•åšé”™è¯¯å¤„ç†ï¼Œ**å®šä¹‰å¹¶ä½¿ç”¨é”™è¯¯è¾¹ç•Œæ¥å¤„ç†æ¸²æŸ“æ—¶çš„é”™è¯¯ï¼Œè€ŒJavaScript é”™è¯¯**(å¼‚æ­¥setTimeout å’Œ äº‹ä»¶å¤„ç† å‘ç”Ÿçš„é”™è¯¯) **å› ä¸ºä¸ä¼šå½±å“UIçš„å±•ç¤ºè€Œæ— éœ€åšé”™è¯¯è¾¹ç•Œçš„åŒæ ·å¤„ç†**ã€‚









<p align="right"> 2019å¹´11æœˆ28æ—¥ </p>

[1]:https://zh-hans.reactjs.org/docs/error-boundaries.html#how-about-event-handlers